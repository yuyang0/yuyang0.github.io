

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" href="/img/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Yu Yang">
  <meta name="keywords" content="">
  
    <meta name="description" content="js运行方式 &lt;script&gt;…..&lt;&#x2F;script&gt;内嵌 &lt;script src&#x3D;&quot;path-to-js-file&quot;\&gt; &lt;&#x2F;script&gt; 外部js文件 事件处理，比如button的 onclick, onmouseover等等 javascript urls 任何能使用url的地方，比如 a 标签的href，form的act">
<meta property="og:type" content="article">
<meta property="og:title" content="Client-Side javascript">
<meta property="og:url" content="https://yuyang0.github.io/notes/client-javascript/index.html">
<meta property="og:site_name" content="yuyang&#39;s blog">
<meta property="og:description" content="js运行方式 &lt;script&gt;…..&lt;&#x2F;script&gt;内嵌 &lt;script src&#x3D;&quot;path-to-js-file&quot;\&gt; &lt;&#x2F;script&gt; 外部js文件 事件处理，比如button的 onclick, onmouseover等等 javascript urls 任何能使用url的地方，比如 a 标签的href，form的act">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yuyang0.github.io/static/img/DOM-tree.png">
<meta property="article:published_time" content="2014-02-19T03:54:17.000Z">
<meta property="article:modified_time" content="2022-05-09T12:58:18.222Z">
<meta property="article:author" content="Yu Yang">
<meta property="article:tag" content="lang">
<meta property="article:tag" content="js">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://yuyang0.github.io/static/img/DOM-tree.png">
  
  
  <title>Client-Side javascript - yuyang&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"yuyang0.github.io","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0,"placement":"right"},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"LyT8mpSI2Jq9CRhOtNOgBXkE-9Nh9j0Va","app_key":"fUOlkXhD9wcmxOTed9NdlqPH","server_url":"https://lyt8mpsi.lc-cn-e1-shared.com","path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>yuyang&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://rmt.dogedoge.com/fetch/fluid/storage/bg/dojm2h.png?w=1920&q=100&fmt=webp') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Client-Side javascript">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2014-02-19 11:54" pubdate>
        2014年2月19日 中午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      11k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      96 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Client-Side javascript</h1>
            
            <div class="markdown-body">
              <h1 id="js运行方式"><a href="#js运行方式" class="headerlink" title="js运行方式"></a>js运行方式</h1><ol>
<li><code>&lt;script&gt;…..&lt;/script&gt;</code>内嵌</li>
<li><code>&lt;script src=&quot;path-to-js-file&quot;\&gt; &lt;/script&gt;</code> 外部js文件</li>
<li>事件处理，比如button的 onclick, onmouseover等等</li>
<li>javascript urls<ul>
<li><p>任何能使用url的地方，比如 a 标签的href，form的action使用如下代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;javascript: alert(&#x27;hello world&#x27;);&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>这相当于单行代码，以javascript：开头，告诉浏览器下面的是js代码，当这行js有返回值时，firefox会替换掉当<br>前的页面为js的执行结果，所以如果要阻止这种行为，那么可以统一在js代码的前面加上void ，比如</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;javascript:void new Date().toLocaleTimeString();&quot;</span>&gt;</span>Check the time without overwriting the document<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Bookmarklets 加入书签，那么这段代码就相当于直接插入了当前页面，比如订阅到鲜果的书签：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">javascript</span>:<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;http://xianguo.com/subscribe?url=&#x27;</span>+<span class="hljs-built_in">encodeURIComponent</span>(location.<span class="hljs-property">href</span>), <span class="hljs-string">&#x27;xianguo&#x27;</span>);<span class="hljs-title function_">void</span>(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h1 id="global-window-object"><a href="#global-window-object" class="headerlink" title="global window object"></a>global window object</h1><h2 id="timers"><a href="#timers" class="headerlink" title="timers"></a>timers</h2><ol>
<li>setTimeout(callback, timeout) :<br>只运行一次callback，返回值可以传递给clearTimeout来清除定时器</li>
<li>clearTimeout()</li>
<li>setInterval(callback, interval) :<br>每隔interval就运行一次callback,返回值可以传递给clearInterval来清除定<br>时器</li>
<li>clearInterval()</li>
</ol>
<h2 id="window-location"><a href="#window-location" class="headerlink" title="window.location"></a>window.location</h2><p>window.location指向一个Location object,这个object有一系列的属性,以<br><a target="_blank" rel="noopener" href="http://www.oreilly.com:1234/catalog/search.html?q=JavaScript&amp;m=10#results">http://www.oreilly.com:1234/catalog/search.html?q=JavaScript&amp;m=10#results</a><br>为例</p>
<ol>
<li>href: 整个url,如果对该属性赋值,则可以重定向到新url</li>
<li>protocal: ‘http:’</li>
<li>host: ‘<a target="_blank" rel="noopener" href="http://www.oreilly.com:1234/">http://www.oreilly.com:1234</a>‘</li>
<li>hostname: ‘<a target="_blank" rel="noopener" href="http://www.oreilly.com/">http://www.oreilly.com</a>‘</li>
<li>port: ‘1234’ 是一个字符串,不是数字</li>
<li>pathname: ‘&#x2F;catalog&#x2F;search.html’</li>
<li>search: ‘?q&#x3D;JavaScript&amp;m&#x3D;10’</li>
<li>hash: ‘#results’ anchor part of url</li>
</ol>
<h2 id="window-history"><a href="#window-history" class="headerlink" title="window.history"></a>window.history</h2><ol>
<li>history.forward(): 前进</li>
<li>history.back(): 后退</li>
<li>history.go(2), history.go(-2) : 前进2个页面,后退两个页面</li>
</ol>
<h2 id="window-navigator"><a href="#window-navigator" class="headerlink" title="window.navigator"></a>window.navigator</h2><ol>
<li>appName:</li>
<li>appVersion:</li>
<li>userAgent:</li>
<li>paltForm</li>
</ol>
<h2 id="window-document"><a href="#window-document" class="headerlink" title="window.document"></a>window.document</h2><ol>
<li>referrer: 一个错误的拼写, 主要用来指示用户是从什么链接跳转到该文档, 可以 用来防盗链, 和HTTP中referer类似</li>
<li>cookie: 设置cookie</li>
<li>title: text between <code>&lt;title&gt;</code> and <code>&lt;/title&gt;</code>.</li>
<li>domain:</li>
</ol>
<h1 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h1><h2 id="node"><a href="#node" class="headerlink" title="node"></a>node</h2><p>node: DOM树中的一个节点, 以下面这段html为例:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Sample Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>An HTML Document<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>This is a <span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>simple<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> document.<br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>那么DOM树是这样的: <img src="/static/img/DOM-tree.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="节点指针以及属性"><a href="#节点指针以及属性" class="headerlink" title="节点指针以及属性"></a>节点指针以及属性</h3><p>因为是树中的节点所以每个node对象都有以下的指针(以n代表一个node对象):</p>
<ol>
<li>n.parentNode: n的父节点对象</li>
<li>n.previousSibling: n的前一个兄弟节点对象</li>
<li>n.nextSibling: n的下一个兄弟节点对象</li>
<li>n.firstChild: n的第一个子节点对象</li>
<li>n.lastChild: n的最后一个子节点对象</li>
<li>n.childNodes: 返回一个类数组结构,包含所有的子节点.</li>
<li>n.firstElementChild: 第一个元素节点, 这在排除一些空格导致上的文本节点时 特别有用</li>
<li>n.lastElementChild:</li>
<li>n.childElementCount: 子节点中元素节点的个数</li>
</ol>
<p>除了节点指针外, 节点还有其它一些属性:</p>
<ol>
<li><strong>nodeType</strong>: The kind of node this is. Document nodes have the<br>value 9. Element nodes have the value 1. Text nodes have the value<ol start="3">
<li>Comments nodes are 8 and Document- Fragment nodes are 11.</li>
</ol>
</li>
<li><strong>nodeValue</strong>: The textual content of a <strong>Text</strong> or <strong>Comment</strong><br>node.</li>
<li><strong>nodeName</strong>: The tag name of an Element, converted to uppercase.</li>
</ol>
<h3 id="node-type"><a href="#node-type" class="headerlink" title="node type"></a>node type</h3><p>有三种节点类型:</p>
<ul>
<li>Document Node: 最上方的那个节点, 用来代表整个文档, 这种节点一份文档只有 一个</li>
<li>Element Node: 用来代表html元素, 比如上图中的head节点就代表html中 <code>&lt;head&gt;...&lt;/head&gt;</code>.</li>
<li>Text Node: 代表文本,比如上例中 <code>Sample Document</code> 节点.</li>
</ul>
<h3 id="Element-node’s-attribute"><a href="#Element-node’s-attribute" class="headerlink" title="Element node’s attribute"></a>Element node’s attribute</h3><p>element node代表一个html元素, 他可以直接获得以及设置该html元素的属性,假设f 是一个form元素,<br>那么可以使用下面的代码:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript">f.<span class="hljs-property">action</span> === <span class="hljs-string">&quot;http://www.baidu.com&quot;</span> <span class="hljs-comment">// test form&#x27;s action attribute</span><br>f.<span class="hljs-property">method</span> = <span class="hljs-string">&quot;POST&quot;</span>                   <span class="hljs-comment">// set the form&#x27;s method attribute to &quot;POST&quot;</span><br></code></pre></td></tr></table></figure>

<p>注意上面的方式返回值都是字符串, 所以要获得整数,可以使用parseInt, 而且只对 标准的html属性有效,<br>非标准的属性可以使用这两个函数来获取:</p>
<ol>
<li>getAttribute</li>
<li>setAttribute</li>
</ol>
<p>比如在html5中可以给一个元素设置以 <code>data-</code> 作为前缀的属性, 比如 <code>data-id</code>, 支持html5的浏览器会有一个<br><code>dataset</code> 属性, 如果n代表元素节点,那么 <code>n.dataset.id, n.dataset.time</code> 就会分别获得<br><code>data-id</code> 以及 <code>data-time</code> 的 值, 但是在不支持html5的浏览器上这就不是标准属性, 所以就需要<br><code>n.getAttribute(&#39;data-id&#39;), n.getAttribute(&#39;data-time&#39;)</code>.</p>
<h3 id="Element-node’s-content"><a href="#Element-node’s-content" class="headerlink" title="Element node’s content"></a>Element node’s content</h3><ol>
<li>innerHTML : 元素内的 html文本(不包含该元素本身的标签)</li>
<li>textContent&#x2F;innerText: 可以看作是innerHTML去掉所有的 HTML标签后得到的文 本.<br>IE没有定义textContent, firefox没有定义 innerText.</li>
<li>outerHTML: 和innerHTML相同,但是它会包含该元素本身的标签</li>
</ol>
<h2 id="选择DOM节点"><a href="#选择DOM节点" class="headerlink" title="选择DOM节点"></a>选择DOM节点</h2><ol>
<li>document.getElementById: 返回单个DOM节点</li>
<li>document.getElementsByName: 根据name属性查找, 返回NodeList, 这是一个类数 组对象, 只读.</li>
<li>document.getElementsByTagName</li>
<li>document.getElementsByClassName</li>
<li>document.querySelectorAll: 通过css selector来选择元素, 返回一个类数组结 构</li>
<li>document.querySelector: 和 querySelectorAll 类似,只是它值返回第一个匹配 的对象,<br>如果没有匹配的那么返回 null.</li>
</ol>
<h2 id="创建新DOM节点"><a href="#创建新DOM节点" class="headerlink" title="创建新DOM节点"></a>创建新DOM节点</h2><ol>
<li><p>document.createElement: 创建元素节点</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;div&#x27;</span>);<br></code></pre></td></tr></table></figure>
</li>
<li><p>document.createTextNode: 创建文本节点</p>
</li>
</ol>
<h2 id="插入DOM节点"><a href="#插入DOM节点" class="headerlink" title="插入DOM节点"></a>插入DOM节点</h2><p>可以使用 <code>insertBefore</code> 与 <code>appendChild</code> 这两个节点方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs example">parentOfBeforeNode.insertBefore(NodeToInsert, beforeNode);<br>parentElem.appendChild(nodeToInsert);<br></code></pre></td></tr></table></figure>

<p>有两个方便的函数:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> before = <span class="hljs-keyword">function</span>(<span class="hljs-params">parent, before, elem</span>)&#123;<br>  <span class="hljs-comment">// check if passed ``parent&#x27;&#x27;</span><br>  <span class="hljs-keyword">if</span> (! !!elem)&#123;<br>    elem = before;<br>    before = parent;<br>    parent = before.<span class="hljs-property">parentNode</span>;<br>  &#125;<br>  parent.<span class="hljs-title function_">insertBefore</span>(<span class="hljs-title function_">checkElem</span>(elem), before);<br>&#125;;<br><br><span class="hljs-keyword">var</span> append = <span class="hljs-keyword">function</span>(<span class="hljs-params">parent, elem</span>)&#123;<br>  parent.<span class="hljs-title function_">appendChild</span>(<span class="hljs-title function_">checkElem</span>(elem));<br>&#125;;<br></code></pre></td></tr></table></figure>

<h2 id="删除-替换DOM节点"><a href="#删除-替换DOM节点" class="headerlink" title="删除,替换DOM节点"></a>删除,替换DOM节点</h2><p>删除节点可以用 <code>removeChild</code> 函数.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs example">NodeParent.removeChild(NodeToRemove);<br></code></pre></td></tr></table></figure>

<p>所以你如果要删除一个DOM节点 <code>n</code>, 应该使用这样的代码:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">n.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">removeChild</span>(n);<br></code></pre></td></tr></table></figure>

<p>替换一个节点使用 replaceChild 方法.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">n.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">replaceChild</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTextNode</span>(<span class="hljs-string">&quot;[ REDACTED ]&quot;</span>), n);<br></code></pre></td></tr></table></figure>

<h2 id="位置-scroll"><a href="#位置-scroll" class="headerlink" title="位置,scroll"></a>位置,scroll</h2><p>有两种坐标系统, 一种是 viewpoint coordinate, 一种是 document coordinate, 前<br>者只考虑可见的窗口部分,也就是说坐标系的原点在窗口的左上角,也就是所谓的 client<br>area的左上角, 通常这就是浏览器的窗口(不包括菜单栏, 工具栏,任务栏), 但是如果文档是显示在一个iframe中,<br>那么就是只包含iframe占用的部分, 后者还要 考虑滚动条,(坐标系的原点在文档的左上角).一般二者可以这样转换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs example">documentX = viewpointX + scrollX<br>documentY = viewpointY + scrollY<br></code></pre></td></tr></table></figure>

<p>scrollX, scrollY 代表滚动条滚动的距离.</p>
<ol>
<li><p>获得viewpoint坐标</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> box = e.<span class="hljs-title function_">getBoundingClientRect</span>()<br>box.<span class="hljs-property">top</span>;<br>box.<span class="hljs-property">right</span>;<br>box.<span class="hljs-property">bottom</span>;<br>box.<span class="hljs-property">left</span>;<br></code></pre></td></tr></table></figure>

<p>e是一个DOM节点元素, 返回的那几个属性都可以为负值或者大于屏幕, 这意味着该 元素目前不在视图之中.<br><strong>根据这四个值我们可以计算元素的精确大小</strong>.对隐藏元 素无效.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> box = e.<span class="hljs-title function_">getBoundingClientRect</span>();<br><span class="hljs-keyword">var</span> w = box.<span class="hljs-property">width</span> || (box.<span class="hljs-property">right</span> - box.<span class="hljs-property">left</span>); <span class="hljs-comment">// width</span><br><span class="hljs-keyword">var</span> h = box.<span class="hljs-property">height</span> || (box.<span class="hljs-property">bottom</span> - box.<span class="hljs-property">top</span>); <span class="hljs-comment">// height</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>获得滚动条的offset</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getScrollOffsets</span>(<span class="hljs-params">w</span>) &#123;<br>  <span class="hljs-comment">// Use the specified window or the current window if no argument</span><br>  w = w || <span class="hljs-variable language_">window</span>;<br>  <span class="hljs-comment">// This works for all browsers except IE versions 8 and before</span><br>  <span class="hljs-keyword">if</span> (w.<span class="hljs-property">pageXOffset</span> != <span class="hljs-literal">null</span>)&#123;<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-attr">scrollX</span>: w.<span class="hljs-property">pageXOffset</span>, <span class="hljs-attr">scrollY</span>: w.<span class="hljs-property">pageYOffset</span>&#125;;<br>  &#125;<br>  <span class="hljs-comment">// For IE (or any browser) in Standards mode</span><br>  <span class="hljs-keyword">var</span> d = w.<span class="hljs-property">document</span>;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">compatMode</span> == <span class="hljs-string">&quot;CSS1Compat&quot;</span>)&#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">scrollX</span>: d.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollLeft</span>,<br>      <span class="hljs-attr">scrollY</span>: d.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollTop</span><br>    &#125;;<br>  &#125;<br>  <span class="hljs-comment">// For browsers in Quirks mode</span><br>  <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">scrollX</span>: d.<span class="hljs-property">body</span>.<span class="hljs-property">scrollLeft</span>, <span class="hljs-attr">scrollY</span>: d.<span class="hljs-property">body</span>.<span class="hljs-property">scrollTop</span> &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>scroll</p>
<ul>
<li>scrollTo(aka scroll): window对象的方法, 指定x,y坐标, 浏览器就会滚动到 对应位置</li>
<li>scrollIntoView: 一个Dom 节点的方法, 可以将这个元素滚动到视图中来.</li>
</ul>
</li>
</ol>
<h1 id="修改css"><a href="#修改css" class="headerlink" title="修改css"></a>修改css</h1><p>注意因为js中标识符中不能使用 - , 所以使用驼峰命名, 比如css的 <code>font-size</code> 在js 中就用, <code>fontSize</code>.</p>
<h2 id="使用style属性来修改css"><a href="#使用style属性来修改css" class="headerlink" title="使用style属性来修改css"></a>使用style属性来修改css</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">e.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = <span class="hljs-string">&quot;absolute&quot;</span>;<br>e.<span class="hljs-property">style</span>.<span class="hljs-property">fontFamily</span> = <span class="hljs-string">&quot;sans-serif&quot;</span>;<br>e.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-string">&quot;#ffffff&quot;</span>;<br></code></pre></td></tr></table></figure>

<p>代码中 e 是一个 Element Node. 注意上面的代码实际是创建行内样式, 因此设置 样式时很有效, 因为行内样式优先级最高,<br>但是获取样式就不能用这种方法, 因为 很可能该元素的样式在外部样式表中, 而不是行内样式中, 那么这种情况你使用这 样的代码<br><code>e.style.position</code> 会返回 “”,</p>
<h2 id="获取当前的样式"><a href="#获取当前的样式" class="headerlink" title="获取当前的样式"></a>获取当前的样式</h2><p>返回当前应用在该元素上的某项css值.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> getStyle = <span class="hljs-keyword">function</span> (<span class="hljs-params">elem, name</span>)&#123;<br>  <span class="hljs-keyword">if</span>(elem.<span class="hljs-property">currentStyle</span>)&#123;   <span class="hljs-comment">// IE browser</span><br>    <span class="hljs-keyword">return</span> elem.<span class="hljs-property">currentStyle</span>[name];<br>  &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!! <span class="hljs-variable language_">window</span>.<span class="hljs-property">getComputedStyle</span>)&#123;<br>    <span class="hljs-comment">// W3C method(window.getComputedStyle)</span><br>    name = name.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/([A-Z])/g</span>, <span class="hljs-string">&quot;-$1&quot;</span>);<br>    name = name.<span class="hljs-title function_">toLowerCase</span>();<br>    <span class="hljs-keyword">var</span> s = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getComputedStyle</span>(elem, <span class="hljs-string">&quot;&quot;</span>);<br>    <span class="hljs-keyword">return</span> s &amp;&amp; s.<span class="hljs-title function_">getPropertyValue</span>(name);<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>上面的函数可以这样使用 <code>getStyle(document.body, &#39;font-size&#39;)</code>, 但是它在获 取一些值比如 width<br>时, 可能返回 “%11”这样的值, 而不是计算后的值.</p>
<h2 id="className"><a href="#className" class="headerlink" title="className"></a>className</h2><p>通过className属性来修改HTML元素的 class属性, 之所以不用class这个词是因为它是 js的关键字.</p>
<h1 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h1><h2 id="Event-Object"><a href="#Event-Object" class="headerlink" title="Event Object"></a>Event Object</h2><p>通用属性:</p>
<ol>
<li>type: 一个字符串,比如 ‘load’, ‘click’, ‘mouseover’等等.</li>
<li>target&#x2F;srcElement: 触发事件的DOM元素, 后者是IE</li>
<li>stopPropagation()&#x2F;cancelBubble: 阻止冒泡, 后者是IE</li>
<li>preventDefault()&#x2F;returnValue&#x3D;false: 阻止默认行为, 后者是IE</li>
</ol>
<p>还有一些事件有一些特别的属性:</p>
<ol>
<li>鼠标事件有以下几个比较重要的属性:<ul>
<li>clientX, clientY: 鼠标在窗口中X, Y坐标, viewpoint coordinate.</li>
<li>pageX, pageY : 鼠标相对于文档的x, Y坐标, document coordinate(IE中无效).</li>
</ul>
</li>
<li>键盘事件有: ctrlKey, shiftKey, keyCode</li>
</ol>
<h2 id="常用事件类型"><a href="#常用事件类型" class="headerlink" title="常用事件类型"></a>常用事件类型</h2><h3 id="window的事件"><a href="#window的事件" class="headerlink" title="window的事件"></a>window的事件</h3><ol>
<li>load</li>
<li>scroll</li>
</ol>
<h3 id="UI事件"><a href="#UI事件" class="headerlink" title="UI事件"></a>UI事件</h3><ol>
<li>focus: element gains input focus</li>
<li>blur: element loses input focus</li>
</ol>
<h3 id="鼠标事件"><a href="#鼠标事件" class="headerlink" title="鼠标事件"></a>鼠标事件</h3><ol>
<li>click</li>
<li>dblclick</li>
<li>mouseover</li>
<li>mouseout</li>
<li>mousedown</li>
<li>mouseup</li>
<li>mousemove</li>
</ol>
<h3 id="键盘事件"><a href="#键盘事件" class="headerlink" title="键盘事件"></a>键盘事件</h3><ul>
<li>keydown&#x2F;keypress: 二者是同义事件, 但是在阻止按键的默认行为时则只能用 keypress, 当你按组合快捷键时,<br>它会触发多个该类事件.</li>
<li>keyup</li>
</ul>
<h3 id="表单事件"><a href="#表单事件" class="headerlink" title="表单事件"></a>表单事件</h3><ol>
<li>select: 选择了文本时触发</li>
<li>change: &lt;input type&#x3D;”text” &#x2F;&gt;, &lt;input type&#x3D;”password” &#x2F;&gt;,<br>&lt;select&gt;, <code>&lt;textarea&gt;</code> 等的内容改变且失去焦点时触发. 如果是文本框,当然还有keypress 事件.</li>
<li>submit: 这是form对象的事件, 它在表单被提交时触发.</li>
<li>reset</li>
</ol>
<h2 id="Register-Event-Handler"><a href="#Register-Event-Handler" class="headerlink" title="Register Event Handler"></a>Register Event Handler</h2><ol>
<li><p>onevent: 实际就是设置元素的html属性.基本代码模式如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs example">window.onload = function(evt)&#123;...&#125;;<br></code></pre></td></tr></table></figure>

<p>这种方法有一些优缺点:</p>
<ul>
<li>优点: 事件处理函数中this被正确绑定到当前元素,同时这种方法兼容性很好</li>
<li>缺点: 一个元素对一类事件只能绑定一个事件处理函数, 重复绑定会覆盖以前的 绑定.<br>同时事件对象参数只在非IE浏览器有效(IE浏览器使用全局事件对象).</li>
</ul>
</li>
<li><p>addEventListener: 代码模式如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs example">window.addEventListener(&#x27;load&#x27;, function()&#123;...&#125;, false);<br></code></pre></td></tr></table></figure>

<ul>
<li>优点: 可以绑定多个事件处理函数, this被正确绑定, event对象作为第一个参 数传递给事件处理函数</li>
<li>缺点: IE不支持</li>
</ul>
</li>
<li><p>IE(attachEvent) 在这种模式中, 如果要阻止浏览器的默认行为, 那么事件处理函数应该调用</p>
</li>
<li><p>这是一个比较好的版本, 你可以从这里<a href="static/doc/add-event.js">下载</a>.</p>
</li>
</ol>
<h2 id="Event-Cancellation"><a href="#Event-Cancellation" class="headerlink" title="Event Cancellation"></a>Event Cancellation</h2><h3 id="阻止浏览器默认行为"><a href="#阻止浏览器默认行为" class="headerlink" title="阻止浏览器默认行为"></a>阻止浏览器默认行为</h3><p>如果是onevent这种模式注册的事件处理函数, 要阻止浏览器的默认行为, 那么事件处 理函数应该返回false,<br>如果是addEventListener注册的事件处理函数, 要阻止浏览器 的默认行为, 那么事件处理函数应该调用<br><code>event.preventDefault()</code>. 如果是 IE(attachEvent)注册的事件处理函数, 那么事件处理函数应该调用<br><code>event.returnValue=false;</code>. 因此为了使这三中情况都能生效, 一般使用这样的代 码:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> eventHandler = <span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>)&#123;<br>  evt = evt || <span class="hljs-variable language_">window</span>.<span class="hljs-property">event</span>;    <span class="hljs-comment">// for IE</span><br><br>  <span class="hljs-keyword">if</span> (evt.<span class="hljs-property">preventDefault</span>)&#123;      <span class="hljs-comment">// standard technique</span><br>    evt.<span class="hljs-title function_">preventDefault</span>();<br>  &#125;<br>  <span class="hljs-keyword">if</span> (evt.<span class="hljs-property">returnValue</span>)&#123;         <span class="hljs-comment">// IE</span><br>    evt.<span class="hljs-property">returnValue</span> = <span class="hljs-literal">false</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;                 <span class="hljs-comment">// onevent</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="阻止事件冒泡"><a href="#阻止事件冒泡" class="headerlink" title="阻止事件冒泡"></a>阻止事件冒泡</h3><p>阻止事件冒泡, 如果event有stopPropagation, 那么调用该函数, 如果是IE, 设置 cancelBubble设为true.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> eventHandler = <span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>)&#123;<br>  <span class="hljs-keyword">if</span> (evt &amp;&amp; evt.<span class="hljs-property">stopPropagation</span>)&#123; <span class="hljs-comment">// non IE</span><br>    evt.<span class="hljs-title function_">stopPropagation</span>();<br>  &#125;<span class="hljs-keyword">else</span>&#123;                        <span class="hljs-comment">// IE</span><br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">event</span>.<span class="hljs-property">cancelBubble</span> = <span class="hljs-literal">true</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="通用函数"><a href="#通用函数" class="headerlink" title="通用函数"></a>通用函数</h2><ol>
<li><p>获得事件处理函数中event对象(IE使用全局的event对象, 而非IE显式的传递event 对象作为参数给事件处理函数)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> eventhanlder = <span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>)&#123;<br>  evt = evt || <span class="hljs-variable language_">window</span>.<span class="hljs-property">event</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h1 id="ajax"><a href="#ajax" class="headerlink" title="ajax"></a>ajax</h1><h2 id="Create-XMLHttpRequest"><a href="#Create-XMLHttpRequest" class="headerlink" title="Create XMLHttpRequest"></a>Create XMLHttpRequest</h2><p>IE6没有标准的XMLHttpRequest构造函数, 可以使用以下代码模拟:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// Emulate the XMLHttpRequest() constructor in IE5 and IE6</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">XMLHttpRequest</span> === <span class="hljs-literal">undefined</span>) &#123;<br>  <span class="hljs-variable language_">window</span>.<span class="hljs-property">XMLHttpRequest</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-comment">// Use the latest version of the ActiveX object if available</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActiveXObject</span>(<span class="hljs-string">&quot;Msxml2.XMLHTTP.6.0&quot;</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (e1) &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// Otherwise fall back on an older version</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActiveXObject</span>(<span class="hljs-string">&quot;Msxml2.XMLHTTP.3.0&quot;</span>);<br>      &#125; <span class="hljs-keyword">catch</span>(e2) &#123;<br>        <span class="hljs-comment">// Otherwise, throw an error</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;XMLHttpRequest is not supported&quot;</span>);<br>      &#125;<br>    &#125;<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>然后使用 <code>var req = new XMLHttpRequest()</code> 来创建</p>
<h2 id="open"><a href="#open" class="headerlink" title="open"></a>open</h2><p>指定verb(‘GET’, ‘POST’), url, async(true为异步, false为同步).</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs example">req.open(verb, url [, async]);<br></code></pre></td></tr></table></figure>

<p>接着你可以使用 <code>setRequestHeader</code> 来指定http 头部, 这在使用 POST时特别重要,<br>因为你要指定你传递的数据类型(Content-Type).</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">req.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&quot;text/plain;charset=UTF-8&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>可以使用多个 <code>setRequestHeader</code> 语句.</p>
<h2 id="send"><a href="#send" class="headerlink" title="send"></a>send</h2><p><code>req.send(msg);</code>, 如果是 GET,那么msg为null, 如果是 POST, msg为你要传递的内 容.</p>
<h2 id="Retrieving-the-Response"><a href="#Retrieving-the-Response" class="headerlink" title="Retrieving the Response"></a>Retrieving the Response</h2><p>如果请求完成,那么XMLHttpRequest会有以下属性:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>status</td>
<td>一个数值, 比如200, 404</td>
</tr>
<tr>
<td>statusText</td>
<td>一个字符串,比如”OK”, “Not Found”</td>
</tr>
<tr>
<td>getResponseHeader()</td>
<td>获得HTTP头部</td>
</tr>
<tr>
<td>getAllResponseHeader()</td>
<td></td>
</tr>
<tr>
<td>responseText</td>
<td>文本</td>
</tr>
<tr>
<td>responseXML</td>
<td>XML, 实际就是将文本解码成DOM树</td>
</tr>
</tbody></table>
<p>因为http请求一般都是异步发送, 所以必须要有一个事件来通知请求已经完成.这个事 件就是 <code>readystatechange</code>,<br>从理论上上说, 当 XMLHttpRequest 的 readyState属 性变动时都应该触发该事件,<br>但实际并不是如此, 下面是redayState的值:</p>
<table>
<thead>
<tr>
<th>Constant</th>
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody><tr>
<td>UNSENT</td>
<td>0</td>
<td>open() has not been called yet</td>
</tr>
<tr>
<td>OPENED`</td>
<td>1</td>
<td>open() has been called</td>
</tr>
<tr>
<td>HEADERS_RECEIVED</td>
<td>2</td>
<td>Headers have been received</td>
</tr>
<tr>
<td>LOADING</td>
<td>3</td>
<td>The response body is being received</td>
</tr>
<tr>
<td>DONE</td>
<td>4</td>
<td>The response is complete</td>
</tr>
</tbody></table>
<p>XMLHttpRequest readyState values</p>
<p>一般来说从0到1是不会触发事件的, 但是调用send会触发事件,即便这时候 <code>readyState</code> 的值没有改变,都是1,<br>在实践中我们也只对特定的 readyState变动感 兴趣(主要是4, 也就是请求完成),<br>所以在事件处理函数中我们一般要测试 readyState的值比如下面这个函数:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getText</span>(<span class="hljs-params">url, callback</span>) &#123;<br>  <span class="hljs-keyword">var</span> request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();<br>  <span class="hljs-comment">// Create new request</span><br>  request.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;GET&quot;</span>, url);<br>  <span class="hljs-comment">// Specify URL to fetch</span><br>  request.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// Define event listener</span><br>    <span class="hljs-comment">// If the request is compete and was successful</span><br>    <span class="hljs-keyword">if</span> (request.<span class="hljs-property">readyState</span> === <span class="hljs-number">4</span> &amp;&amp; request.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) &#123;<br>      <span class="hljs-comment">// get type</span><br>      <span class="hljs-keyword">var</span> type = request.<span class="hljs-title function_">getResponseHeader</span>(<span class="hljs-string">&quot;Content-Type&quot;</span>);<br>      <span class="hljs-keyword">if</span> (type.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;xml&#x27;</span>) !== -<span class="hljs-number">1</span> &amp;&amp; request.<span class="hljs-property">responseXML</span>)&#123;<br>        <span class="hljs-title function_">callback</span>(request.<span class="hljs-property">responseXML</span>);<br>      &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">&quot;application/json&quot;</span>)&#123;<br>        <span class="hljs-title function_">callback</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(request.<span class="hljs-property">responseText</span>)) <span class="hljs-comment">// JSON response</span><br>      &#125; <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-title function_">callback</span>(request.<span class="hljs-property">responseText</span>);  <span class="hljs-comment">// String response</span><br>      &#125;<br>    &#125;<br>  &#125;;<br>  request.<span class="hljs-title function_">send</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-comment">// Send the request now</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>注意 <code>readyState</code> 为 <code>4</code> 只是说请求已经完成,但并不一定请求成功, 有可能是404 或其它http错误, 只有测试<br><code>status</code> 为 <code>200</code> 时才是成功的http请求.</p>
<h2 id="jsonp"><a href="#jsonp" class="headerlink" title="jsonp"></a>jsonp</h2><p>实际就是创建一个 <code>&lt;script&gt;...&lt;/script&gt;</code> 节点, 然后将其插入文档, 这样浏览器会 自动的发送一个http<br>get请求,并且把请求得到的内容当做 js代码来执行. 根据这个原<br>理,那么服务器必须生成能执行的js代码,而不仅仅只是返回数据,<br>也就是说一般要指定 一个处理函数作为前缀(prefix), 这也是jsonp中p的由来. 为了指定这个处理函数, 一 般在url中指定,<br>比如在url的后面添加 ?jsonp&#x3D;handler 或者 ?callback&#x3D;handler,这<br>样服务器端就知道你指定的处理函数了.</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/notes/">notes</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/lang/">lang</a>
                    
                      <a class="hover-with-bg" href="/tags/js/">js</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/articles/linux-c-messy-code/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Linux平台C语言乱码</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/notes/javascript/">
                        <span class="hidden-mobile">js笔记</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    
      <script type="text/javascript">
        var disqus_config = function() {
          this.page.url = 'https://yuyang0.github.io/notes/client-javascript/';
          this.page.identifier = '/notes/client-javascript/';
        };
        Fluid.utils.loadComments('#disqus_thread', function() {
          var d = document, s = d.createElement('script');
          s.src = '//' + 'yuyang' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        });
      </script>
    
    <noscript>Please enable JavaScript to view the comments</noscript>
  </div>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>














  
<script src="/js/custom.js"></script>



<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
